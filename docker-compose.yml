version: "3.8"

services:
  jenkins:
    image: jenkins/jenkins:lts-jdk17
    container_name: jenkins
    restart: unless-stopped

    # 핵심: docker.sock permission denied 방지 (실습용 가장 확실한 방법)
    user: "0:0"

    ports:
      - "8080:8080"
      - "50000:50000"

    environment:
      - TZ=Asia/Seoul

    volumes:
      # Jenkins 데이터(잡/설정/플러그인) 영구 저장
      - jenkins_home:/var/jenkins_home

      # 핵심: 호스트 Docker 데몬 사용
      - /var/run/docker.sock:/var/run/docker.sock

      # Maven 캐시(속도 개선)
      - maven_cache:/var/jenkins_home/.m2

    # 핵심: GitLab이 실제로 붙어있는 네트워크로 고정 (네 출력 기준: apache_cicd)
    networks:
      - apache_cicd

volumes:
  jenkins_home:
  maven_cache:

networks:
  apache_cicd:
    external: true
